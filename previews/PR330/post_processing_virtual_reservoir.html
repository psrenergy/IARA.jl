<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Virtual reservoirs pre and post processing 路 IARA.jl</title><meta name="title" content="Virtual reservoirs pre and post processing 路 IARA.jl"/><meta property="og:title" content="Virtual reservoirs pre and post processing 路 IARA.jl"/><meta property="twitter:title" content="Virtual reservoirs pre and post processing 路 IARA.jl"/><meta name="description" content="Documentation for IARA.jl."/><meta property="og:description" content="Documentation for IARA.jl."/><meta property="twitter:description" content="Documentation for IARA.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="IARA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">IARA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">About IARA</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="tutorial/first_execution.html">My first execution</a></li><li><a class="tocitem" href="tutorial/case_building.html">Editing physical data</a></li><li><a class="tocitem" href="tutorial/clearing_executions.html">Editing clearing options</a></li></ul></li><li><span class="tocitem">Conceptual overview</span><ul><li><a class="tocitem" href="key_features.html">Key features of IARA</a></li><li><a class="tocitem" href="clearing_procedure.html">The market clearing structure</a></li><li><a class="tocitem" href="hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="conceptual_formulation.html">Conceptual formulations</a></li><li><a class="tocitem" href="centralized_operation_problem.html">Centralized operation problem</a></li><li><a class="tocitem" href="market_clearing_problem.html">Market clearing problem</a></li><li><a class="tocitem" href="heuristic_bids.html">Heuristic bids for bidding groups</a></li><li><a class="tocitem" href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a></li><li class="is-active"><a class="tocitem" href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a><ul class="internal"><li><a class="tocitem" href="#Curveguide-points"><span>Curveguide points</span></a></li><li><a class="tocitem" href="#Water-to-Energy-Factors"><span>Water-to-Energy Factors</span></a></li><li><a class="tocitem" href="#Additional-energy-from-inflows"><span>Additional energy from inflows</span></a></li><li><a class="tocitem" href="#Post-processing-energy-account"><span>Post processing energy account</span></a></li></ul></li><li><a class="tocitem" href="bid_limits.html">Bid price limits</a></li></ul></li></ul></li><li><span class="tocitem">Use guides and tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Building a case from scratch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="build_a_case_from_scratch.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_01_build_base_case.html">Case creation example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manipulating bid data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="bidding_formats.html">Introduction</a></li><li><a class="tocitem" href="heuristic_bid_examples.html">Heuristic bids examples</a></li><li><a class="tocitem" href="tutorial/case_03_build_profile_base_case.html">Profile bids example</a></li><li><a class="tocitem" href="tutorial/case_04_build_multi_min_activation.html">Minimum activation bids example</a></li><li><a class="tocitem" href="tutorial/case_05_build_reservoir_case.html">Virtual reservoir example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Structuring the policy graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="intro_policy_graph.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_06_build_policy_graph.html">Policy graphs example: building</a></li><li><a class="tocitem" href="tutorial/case_06_run_policy_graph.html">Policy graphs example: running</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Custom Plots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="tutorial/plots_tutorial.html">Plotting</a></li></ul></li></ul></li><li><span class="tocitem">Input and Outputs</span><ul><li><a class="tocitem" href="quiver_format.html">Quiver</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Input files</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="input_files.html">Input files table</a></li><li><a class="tocitem" href="how_to_input_fcf.html">How to Input a FCF File</a></li></ul></li><li><a class="tocitem" href="output_files.html">Output files</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="style_guide.html">Style guide</a></li><li><a class="tocitem" href="development_guides.html">Development guides</a></li></ul></li><li><a class="tocitem" href="iara_platform.html">IARA Platform</a></li><li><a class="tocitem" href="api_reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Conceptual overview</a></li><li><a class="is-disabled">Formulations</a></li><li class="is-active"><a href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Pre-and-post-processing-virtual-reservoirs"><a class="docs-heading-anchor" href="#Pre-and-post-processing-virtual-reservoirs">Pre and post processing virtual reservoirs</a><a id="Pre-and-post-processing-virtual-reservoirs-1"></a><a class="docs-heading-anchor-permalink" href="#Pre-and-post-processing-virtual-reservoirs" title="Permalink"></a></h1><p>The virtual reservoir representation in the market clearing problem requires some pre-calculation at the beginning of the run, as well as at the beginning and end of each period. These calculations can use input data and results from optimizing the market clearing subproblem of a previous period, and are utilized to fill and update parameters used in the subproblem.</p><h2 id="Curveguide-points"><a class="docs-heading-anchor" href="#Curveguide-points">Curveguide points</a><a id="Curveguide-points-1"></a><a class="docs-heading-anchor-permalink" href="#Curveguide-points" title="Permalink"></a></h2><p>If the depletion curve is set to uniform, the curveguide points are defined to deplete each reservoir proportionally. This means that the same percentage of each reservoir&#39;s volume will be released over time. Since the <a href="market_clearing_problem.html#waveguide-convex-combination">curveguide is defined</a> as a convex combination of the points, it is sufficient to define the first point of each reservoir as 1 and the second and last points as 0. This ensures that, by the end of the period, each reservoir will have released its water at the same proportion.</p><p>For each virtual reservoir <span>$r$</span>, and hydro unit <span>$h \in J^H_{VR}(r)$</span>, we define the waveguide points as follows:</p><p class="math-container">\[v^{WG}_{r, h, 1} = 1 \quad \text{and} \quad v^{WG}_{r, h, 2} = 0\]</p><h2 id="Water-to-Energy-Factors"><a class="docs-heading-anchor" href="#Water-to-Energy-Factors">Water-to-Energy Factors</a><a id="Water-to-Energy-Factors-1"></a><a class="docs-heading-anchor-permalink" href="#Water-to-Energy-Factors" title="Permalink"></a></h2><p>For a hydro unit <span>$h$</span> at a virtual reservoir <span>$r$</span>, the water-to-energy factor <span>$\zeta_{r,h}$</span> represents the amount of energy (MWh) that can be generated by each <span>$hm^3$</span> of volume at <span>$h$</span> within the hydro units of reservoir <span>$r$</span>. To calculate this factor, we analyze the topology of the cascade to identify which hydro units within <span>$r$</span> lie downstream of <span>$h$</span>. Specifically, we look for hydro units <span>$g \in J^H_VR(r)$</span> such that there exists a path from <span>$h$</span> to <span>$g$</span> through intermediate units. This path is defined by a sequence of units <span>$h, g_1, g_2, \dots, g_n, g$</span>, where each <span>$g_i \in J^H_VR(r)$</span> for all <span>$i \in [n]$</span>, with each unit in the sequence receiving water from the previous one: <span>$h$</span> turbines water to <span>$g_1$</span>, <span>$g_i$</span> turbines water to <span>$g_{i+1}$</span>, and <span>$g_n$</span> turbines water to <span>$g$</span>.</p><p>Let <span>$G$</span> be the set of possible downstream units <span>$g$</span>. Thus, the water-to-energy factor is given by:</p><p class="math-container">\[\zeta_{r,h} = \sum_{g \in G} \rho_g \cdot C_{hm^3/h \rightarrow m^3/s}\]</p><p>where <span>$\rho_g$</span> is the production factor of hydro unit <span>$g$</span>.</p><h2 id="Additional-energy-from-inflows"><a class="docs-heading-anchor" href="#Additional-energy-from-inflows">Additional energy from inflows</a><a id="Additional-energy-from-inflows-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-energy-from-inflows" title="Permalink"></a></h2><p>At the beginning of each period, for each scenario, we calculate the additional energy that is stored in the virtual reservoirs due to inflows. This is done by analyzing the inflow series and the current volume of each hydro unit. The calculation begins at the top of the cascade and proceeds downstream. At each hydro unit <span>$j$</span>, the inflow volume for the period is:</p><p class="math-container">\[a^{vol}_j = \sum_{\tau \in B(t)} a_{j, \tau} \cdot C_{m^3/s \rightarrow hm^3/h} \cdot d(\tau)\]</p><p>The maximum volume of water that can be turbined from hydro unit <span>$j$</span> during the period is:</p><p class="math-container">\[U_j^{vol} = U_j \cdot C_{m^3/s \rightarrow hm^3/h} \cdot \sum_{\tau \in B(t)} d(\tau)\]</p><p>The inflow volume that unavoidably spills from hydro unit <span>$j$</span> is:</p><p class="math-container">\[z^{vol}_j = \max(a^{vol}_j + v^{S_{in}}_j - (V_j + U_j^{vol}), 0)\]</p><p>The additional energy that can be generated by the inflow at hydro unit <span>$j$</span> is:</p><p class="math-container">\[e^{inflow}_r = (a^{vol}_j - z^{vol}_j) \cdot \zeta_{r,j}\]</p><p>where <span>$\zeta_{r,j}$</span> is the water-to-energy factor for hydro unit <span>$j$</span> at virtual reservoir <span>$r$</span>.</p><p>The excess inflow <span>$z^{vol}_j$</span> is added to the downstream hydro unit <span>$g$</span> that receives water from <span>$j$</span>, if it exists, and the process continues downstream until all hydro units in the virtual reservoir have been processed.</p><h2 id="Post-processing-energy-account"><a class="docs-heading-anchor" href="#Post-processing-energy-account">Post processing energy account</a><a id="Post-processing-energy-account-1"></a><a class="docs-heading-anchor-permalink" href="#Post-processing-energy-account" title="Permalink"></a></h2><p>At the end of each period, we want to guarantee that the sum of the energy accounts of the asset owners at a virtual reservoir is equal to the stored energy of the hydro units of this virtual reservoir. For that, we adjust the energy accounts, if necessary. The raw energy accounts can be obtained from the optimization solution: <span>${E^{out}_{r,i}}^*$</span>. The stored energy of each hydro unit <span>$h$</span> can be calculated based on the final volume at the optimization solution <span>${v^{S_{out}}_h}^*$</span> and the water-to-energy factors <span>$\zeta_{r,h}$</span>.</p><p>Stored energy of virtual reservoir <span>$r$</span>: <span>$A=\sum_{h \in J^H_{VR}(r)} {v^{S_{out}}_h}^* \cdot \zeta_{r,h}$</span></p><p>Sum of energy accounts of virtual reservoir <span>$r$</span>: <span>$B =\sum_{i \in I^{VR}(r)} {E^{out}_{r,i}}^*$</span></p><p>For each asset owner <span>$i$</span> at virtual reservoir <span>$r$</span>, we define the post-processed energy account <span>$E&#39;_{r,i}$</span>:</p><p class="math-container">\[E&#39;_{r,i} = {E^{out}_{r,i}}^* \cdot \frac{A}{B}\]</p><p>This way, <span>$\sum_{i \in I^{VR}(r)} E&#39;_{r,i} = A$</span>, and the proportions of energy accounts at <span>$r$</span> are kept.</p><p>For the next period, <span>$E^{in}_{r,i} = E&#39;_{r,i}$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="heuristic_bids_vr.html">芦 Heuristic bids for virtual reservoirs</a><a class="docs-footer-nextpage" href="bid_limits.html">Bid price limits 禄</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 12 August 2025 21:04">Tuesday 12 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
