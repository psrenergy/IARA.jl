<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Heuristic bids for virtual reservoirs · IARA.jl</title><meta name="title" content="Heuristic bids for virtual reservoirs · IARA.jl"/><meta property="og:title" content="Heuristic bids for virtual reservoirs · IARA.jl"/><meta property="twitter:title" content="Heuristic bids for virtual reservoirs · IARA.jl"/><meta name="description" content="Documentation for IARA.jl."/><meta property="og:description" content="Documentation for IARA.jl."/><meta property="twitter:description" content="Documentation for IARA.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="IARA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">IARA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">About IARA</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="tutorial/first_execution.html">My first execution</a></li><li><a class="tocitem" href="tutorial/case_building.html">Editing physical data</a></li><li><a class="tocitem" href="tutorial/clearing_executions.html">Editing clearing options</a></li></ul></li><li><span class="tocitem">Conceptual overview</span><ul><li><a class="tocitem" href="key_features.html">Key features of IARA</a></li><li><a class="tocitem" href="clearing_procedure.html">The market clearing structure</a></li><li><a class="tocitem" href="hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="conceptual_formulation.html">Conceptual formulations</a></li><li><a class="tocitem" href="centralized_operation_problem.html">Centralized operation problem</a></li><li><a class="tocitem" href="market_clearing_problem.html">Market clearing problem</a></li><li><a class="tocitem" href="heuristic_bids.html">Heuristic bids for bidding groups</a></li><li class="is-active"><a class="tocitem" href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a><ul class="internal"><li><a class="tocitem" href="#Sets"><span>Sets</span></a></li><li><a class="tocitem" href="#Parameters"><span>Parameters</span></a></li><li><a class="tocitem" href="#Variables"><span>Variables</span></a></li><li><a class="tocitem" href="#Objective-Function"><span>Objective Function</span></a></li><li><a class="tocitem" href="#Constraints"><span>Constraints</span></a></li><li class="toplevel"><a class="tocitem" href="#Heuristic-bid-for-virtual-reservoir"><span>Heuristic bid for virtual reservoir</span></a></li><li><a class="tocitem" href="#Adjust-markup-vectors-for-asset-owner-i"><span>Adjust markup vectors for asset owner <span>$i$</span></span></a></li><li><a class="tocitem" href="#Adjust-hydro-reference-curve-for-asset-owner-i"><span>Adjust hydro reference curve for asset owner <span>$i$</span></span></a></li><li><a class="tocitem" href="#Apply-adjusted-markup-vectors-to-adjusted-hydro-reference-curve"><span>Apply adjusted markup vectors to adjusted hydro reference curve</span></a></li><li class="toplevel"><a class="tocitem" href="#Supply-Security-Agent"><span>Supply Security Agent</span></a></li></ul></li><li><a class="tocitem" href="supply_function_equilibrium.html">Supply Function Equilibrium</a></li><li><a class="tocitem" href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a></li><li><a class="tocitem" href="bid_limits.html">Bid price limits</a></li></ul></li></ul></li><li><span class="tocitem">Use guides and tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Building a case from scratch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="build_a_case_from_scratch.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_01_build_base_case.html">Case creation example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manipulating bid data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="bidding_formats.html">Introduction</a></li><li><a class="tocitem" href="heuristic_bid_examples.html">Heuristic bids examples</a></li><li><a class="tocitem" href="tutorial/case_03_build_profile_base_case.html">Profile bids example</a></li><li><a class="tocitem" href="tutorial/case_04_build_multi_min_activation.html">Minimum activation bids example</a></li><li><a class="tocitem" href="tutorial/case_05_build_reservoir_case.html">Virtual reservoir example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Structuring the policy graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="intro_policy_graph.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_06_build_policy_graph.html">Policy graphs example: building</a></li><li><a class="tocitem" href="tutorial/case_06_run_policy_graph.html">Policy graphs example: running</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Custom Plots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="tutorial/plots_tutorial.html">Plotting</a></li></ul></li></ul></li><li><span class="tocitem">Input and Outputs</span><ul><li><a class="tocitem" href="quiver_format.html">Quiver</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Input files</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="input_files.html">Input files table</a></li><li><a class="tocitem" href="how_to_input_fcf.html">How to Input a FCF File</a></li></ul></li><li><a class="tocitem" href="output_files.html">Output files</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="style_guide.html">Style guide</a></li><li><a class="tocitem" href="development_guides.html">Development guides</a></li></ul></li><li><a class="tocitem" href="iara_platform.html">IARA Platform</a></li><li><a class="tocitem" href="api_reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Conceptual overview</a></li><li><a class="is-disabled">Formulations</a></li><li class="is-active"><a href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Hydro-reference-curve"><a class="docs-heading-anchor" href="#Hydro-reference-curve">Hydro reference curve</a><a id="Hydro-reference-curve-1"></a><a class="docs-heading-anchor-permalink" href="#Hydro-reference-curve" title="Permalink"></a></h1><p>The hydro reference curve seeks to draw the aggregate bid curve for each virtual reservoir for a given period and scenario, defining price and quantity levels. These results are later used for the heuristic bidding of virtual reservoirs.</p><p>The maximum energy generation in the period and scenario is determined by the amount of stored energy and the turbine limits of the reservoirs. A set of multipliers <span>$\Theta$</span> is defined, ranging uniformly from 0 to 1, and the amount of elements is defined by the user. Each multiplier <span>$\theta \in \Theta$</span> is applied to the maximum amount of available energy. For each value of the multiplier <span>$\theta$</span>, a single optimization model <span>$Z(\theta)$</span> is run, which returns the quantity <span>$q_r^*$</span> for each virtual reservoir and the price <span>$\mu$</span> in the scenario considered.</p><p>Based on these results, the price and quantity segments corresponding to the multiplier <span>$\theta$</span> are defined for each reservoir <span>$r$</span>:</p><ul><li><p><span>$\mu_r(\theta) = \mu^*$</span>, which represents the price for the multiplier <span>$\theta$</span>.</p></li><li><p><span>$q_r(\theta) = q_r^* - \sum_{\vartheta \in \Theta, \vartheta &lt; \theta}{q_r(\vartheta)}$</span>, which defines the quantity for the multiplier <span>$\theta$</span>. It is the incremental quantity generated by the virtual reservoir <span>$r$</span> for the multiplier <span>$\theta$</span>, calculated as the difference between the total generation at <span>$\theta$</span> and the total generation at all previous multipliers.</p></li></ul><p>For each virtual reservoir <span>$r$</span>, this process generates two vectors: one for the price levels <span>$P_r$</span> and one for the quantities <span>$Q_r$</span>. The vectors are ordered in ascending order of price, which is important for constructing the heuristic bid later. The last segment of quantities is extended to reach the total stored energy, as it can be greater than the maximum turbinable energy.</p><p>The variables, constraints, objective function, and parameters of the <span>$Z(\theta)$</span> problem are presented below. Additional symbols are defined in the <a href="heuristic_bids_vr.html#market-clearing-problem">Market Clearing Problem</a> and <a href="heuristic_bids_vr.html#centralized-operation-problem">Centralized Operation Problem</a> sections.</p><h2 id="Sets"><a class="docs-heading-anchor" href="#Sets">Sets</a><a id="Sets-1"></a><a class="docs-heading-anchor-permalink" href="#Sets" title="Permalink"></a></h2><ul><li><span>$\Theta$</span>: Set of reference curve multipliers.</li><li><span>$C$</span>: Set of future cost cutting planes coefficients.</li></ul><h2 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h2><ul><li><span>$\bar{q}_r(\omega)$</span>: Available energy of virtual reservoir <span>$r$</span> for current period, scenario <span>$\omega$</span>. Calculated as the minimum between the total stored energy at <span>$r$</span> and the maximum turbinable energy at <span>$r$</span> considering the period duration: <span>$\bar{q}_r(\omega) = \min(\sum_{i \in I^{VR}(r)} E_{r,i}\; , \; \sum_{h \in J^{H}_{VR}(r)} \sum_{\tau \in B(t)} \rho_h \cdot U_h \cdot d(\tau))$</span></li></ul><h2 id="Variables"><a class="docs-heading-anchor" href="#Variables">Variables</a><a id="Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Variables" title="Permalink"></a></h2><ul><li><span>$q_r$</span>: Total energy generated by virtual reservoir <span>$r$</span> at period.</li><li><span>$\alpha$</span>: Future cost.</li></ul><h2 id="Objective-Function"><a class="docs-heading-anchor" href="#Objective-Function">Objective Function</a><a id="Objective-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Objective-Function" title="Permalink"></a></h2><p class="math-container">\[    \min \; \alpha\\\]</p><h2 id="Constraints"><a class="docs-heading-anchor" href="#Constraints">Constraints</a><a id="Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Constraints" title="Permalink"></a></h2><h3 id="Future-Cost-Cuts"><a class="docs-heading-anchor" href="#Future-Cost-Cuts">Future Cost Cuts</a><a id="Future-Cost-Cuts-1"></a><a class="docs-heading-anchor-permalink" href="#Future-Cost-Cuts" title="Permalink"></a></h3><p class="math-container">\[    \alpha \ge \sum_{j \in J^H_{VR}} m_j \cdot v^{S_{out}}_j + b \quad \forall (m, b) \in C\]</p><h3 id="Physical-Virtual-Coupling"><a class="docs-heading-anchor" href="#Physical-Virtual-Coupling">Physical-Virtual Coupling</a><a id="Physical-Virtual-Coupling-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Virtual-Coupling" title="Permalink"></a></h3><p class="math-container">\[    \sum_{\tau \in B(t)}{\sum_{h \in J^H_{VR}(r)} \rho_h u_{h, \tau} } = q_r \quad \forall r \in J^{VR}\]</p><h3 id="Generation-reference"><a class="docs-heading-anchor" href="#Generation-reference">Generation reference</a><a id="Generation-reference-1"></a><a class="docs-heading-anchor-permalink" href="#Generation-reference" title="Permalink"></a></h3><p class="math-container">\[    \sum_{r \in J^{VR}} q_r = \theta \cdot \sum_{r \in J^{VR}} \bar{q}_r(\omega) \quad :\mu\]</p><h3 id="Non-decreasing-Generation-Reference"><a class="docs-heading-anchor" href="#Non-decreasing-Generation-Reference">Non-decreasing Generation Reference</a><a id="Non-decreasing-Generation-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Non-decreasing-Generation-Reference" title="Permalink"></a></h3><p>This constraint ensures that the curve of the virtual reservoir generation is non-decreasing, which is essential for keeping the incremental generation quantities non-negative. Generally, this constraint is satisfied by the optimization model, but in degenerate cases, it may not hold. Therefore, we explicitly enforce it.</p><p class="math-container">\[    q_r(\theta) \ge q_r(\vartheta) \quad \forall r \in J^{VR}, \forall \vartheta \in \Theta, \vartheta &lt; \theta\]</p><p class="math-container">\[    q_r \ge \sum_{\vartheta \in \Theta, \vartheta &lt; \theta} q_r(\vartheta)\]</p><h3 id="Hydro-Balance"><a class="docs-heading-anchor" href="#Hydro-Balance">Hydro Balance</a><a id="Hydro-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Hydro-Balance" title="Permalink"></a></h3><p class="math-container">\[    v_{j, \tau+1} = v_{j, \tau} - u_{j, \tau} - z_{j, \tau}
    + \sum_{n \in J^H_U(j)}{u_{n, \tau}} 
    + \sum_{n \in J^H_Z(j)}{z_{n, \tau}} +  a_{j, \tau} + a^S_{j, \tau} \\
    \quad \forall j \in J^H_{VR}, \tau \in B(t)\]</p><p class="math-container">\[    v^{S_{in}}_j = v_{j, 1}
    \quad \forall j \in J^H\]</p><p class="math-container">\[    v^{S_{out}}_j = v_{j, |B(t)| + 1}
    \quad \forall j \in J^H\]</p><h1 id="Heuristic-bid-for-virtual-reservoir"><a class="docs-heading-anchor" href="#Heuristic-bid-for-virtual-reservoir">Heuristic bid for virtual reservoir</a><a id="Heuristic-bid-for-virtual-reservoir-1"></a><a class="docs-heading-anchor-permalink" href="#Heuristic-bid-for-virtual-reservoir" title="Permalink"></a></h1><p>For each asset owner <span>$i$</span> in the virtual reservoir <span>$r$</span>, the heuristic bid is constructed based on the hydro reference curve <span>$[Q_{r, g}, P_{r,g}]_{g \in G}$</span>, the pairs of reference and markup <span>$(s_{i,f}, m_{i,f})_{f \in F^{AO}(i)}$</span>, the purchase discount rate <span>$o_i$</span>, and the energy accounts <span>$E^{in}_r$</span>.</p><p>The available parameters for the heuristic bid are either input data or results from the market clearing problem. They are defined as follows:</p><ul><li><span>$F^{AO}(i)$</span>: Set of risk factors for asset owner <span>$i$</span>.</li><li><span>$G$</span>: Set of points on the hydro reference curve.</li><li><span>$s_{i,f}$</span>: Maximum account share at which the risk factor <span>$p_{i,f}$</span> is applied for asset owner <span>$i$</span>, with <span>$s_{i,f} &gt; s_{i,f+1}$</span>, <span>$s_{i,1} &gt; 0$</span>, and <span>$s_{i, |F^{AO}(i)|} = 1$</span>.</li><li><span>$m_{i,f}$</span>: Risk factor for asset owner <span>$i$</span> at level <span>$f$</span>.</li><li><span>$o_i$</span>: Purchase discount rate for asset owner <span>$i$</span>.</li><li><span>$E^{in}_{r,i}$</span>: Energy account of asset owner <span>$i$</span> in virtual reservoir <span>$r$</span>.</li><li><span>$P_{r, g}$</span>: Price at point <span>$g$</span> of the hydro reference curve for virtual reservoir <span>$r$</span>.</li><li><span>$Q_{r, g}$</span>: Quantity at point <span>$g$</span> of the hydro reference curve for virtual reservoir <span>$r$</span>.</li></ul><p>The calculation of the heuristic bid for virtual reservoir <span>$r$</span> can be split into three steps:</p><ol><li>Adjusting the pairs of reference and markup <span>$(s_{i,f}, m_{i,f})_{f \in F^{AO}(i)}$</span> into pairs of energy quantity and markup <span>$(s&#39;_{i,f}, m_{i,f})_{f \in F^{AO}(i)}$</span>.</li><li>Adjusting the hydro reference curve for each asset owner <span>$i$</span>, based on the energy accounts.</li><li>Applying the adjusted markup vectors to the adjusted hydro reference curve to obtain the heuristic bid for asset owner <span>$i$</span>.</li></ol><h2 id="Adjust-markup-vectors-for-asset-owner-i"><a class="docs-heading-anchor" href="#Adjust-markup-vectors-for-asset-owner-i">Adjust markup vectors for asset owner <span>$i$</span></a><a id="Adjust-markup-vectors-for-asset-owner-i-1"></a><a class="docs-heading-anchor-permalink" href="#Adjust-markup-vectors-for-asset-owner-i" title="Permalink"></a></h2><p>The markup vectors for asset owner <span>$i$</span> form a set of pairs <span>$(s_{i,f}, m_{i,f})_{f \in F^{AO}(i)}$</span>, where <span>$s_{i,f}$</span> is the maximum share of the energy account at which the risk factor <span>$m_{i,f}$</span> is applied. The image below illustrates the markup vectors for an asset owner, where <span>$(s_{i,f}, m_{i,f})_{f \in F^{AO}(i)} = \{(0.1, 0.3), (0.6, 0.05), (1.0, -0.2)\}$</span>. The risk factor curve decreases as the share increases, meaning that when the agent holds a smaller amount of water, it is valued higher. However, as the share increases, the value of the water decreases.</p><p><img src="assets/risk_factor_account_share.png" alt="Risk factor over account share"/></p><p>We aim to understand the relationship between energy bid and the risk factor by examining how the energy bid influences the share of the energy account. As the energy bid increases, the share of the energy account may decrease. In this context, the risk factor is dynamic and varies depending on the energy bid and the consequential share of the energy account. The following calculated parameters are used:</p><ul><li><span>$E_{r,i}$</span>: Energy account of asset owner <span>$i$</span> in virtual reservoir <span>$r$</span>, considering the initial energy account and the inflow, <span>$E_{r,i} = E^{in}_{r,i} + e^{inflow}_r \cdot \gamma^{VR}_{r,i}$</span>, where <span>$e^{inflow}_r$</span> is the inflow energy of virtual reservoir <span>$r$</span> and <span>$\gamma^{VR}_{r,i}$</span> is the inflow share of asset owner <span>$i$</span> in virtual reservoir <span>$r$</span>.</li><li><span>$T$</span>: Sum of the energy accounts of all asset owners in the virtual reservoir <span>$r$</span>, <span>$T = \sum_{i \in I^{VR}(r)} E_{r,i}$</span>.</li><li><span>$S_i$</span>: Share of the energy account of asset owner <span>$i$</span> in the virtual reservoir <span>$r$</span>, calculated as <span>$S_i = \frac{E_{r,i}}{T}$</span>.</li><li><span>$j_{S_i}$</span>: Index of the first risk factor above the share <span>$S_i$</span> of asset owner <span>$i$</span>. <span>$j_{S_i} = \min\{f \mid s_{i,f} \ge S_i\}$</span>.</li><li><span>$n_i$</span>: Number of risk factors for asset owner <span>$i$</span>, <span>$n_i = |F^{AO}(i)|$</span>.</li></ul><p>The energy account share as a function of the energy bid is <span>$s(q) = \frac{E_{r,i} - q}{T} = S_i - \frac{q}{T}$</span>.</p><p>For our example, considering <span>$S_i = 10$</span>, <span>$T=12.5$</span>, the image below shows the graph of the function.</p><p><img src="assets/account_share_energy_bid.png" alt="Account share over energy bid"/></p><p>If <span>$f(s)$</span> is the risk factor as a function of the share <span>$s$</span>, then <span>$f(s(q))$</span> will give us the risk factor as a function of the energy bid <span>$q$</span>. Intuitively, we take the graph of the function <span>$f(s)$</span>, mirror it on a vertical axis so the domain remains the same, stretch it to the right by a factor of <span>$T$</span>, and then shift it to the left by <span>$T - E_{r,i}$</span>. The image below shows the graph of the function <span>$f(s(q))$</span> for our example.</p><p><img src="assets/risk_factor_energy_bid.png" alt="Risk factor over energy bid"/></p><p>Additionally, for the negative side of the energy bid, we apply the purchase discount rate <span>$o_i$</span> to the risk factor, which is <span>$o_i = 0.1$</span> in our example. The image below shows the final graph of the risk factor as a function of the energy bid for our example.</p><p><img src="assets/risk_factor_energy_bid_discounted.png" alt="Risk factor over energy bid discounted"/></p><p>The pair of vectors <span>$m&#39;, s&#39;$</span> representing the risk factors and the energy bid segments for asset owner <span>$i$</span> are defined as follows:</p><p class="math-container">\[\{(s&#39;_{i,f}, m&#39;_{i,f})\}_{f \in F^{AO}(i)} = \begin{bmatrix}
    -(s_{i, n_i} - s_{n-1}) \cdot T &amp; &amp; m_{i, n_i} - o_i \\
    -(s_{i, n_i-1} - s_{n-1}) \cdot T &amp; &amp; m_{i, n_i-1} - o_i \\
    \vdots &amp; &amp; \vdots \\
    -(s_{i, j_{S_i}+1} - s_{i, j_{S_i}}) \cdot T &amp; &amp; m_{i, j_{S_i}+1} - o_i \\
    -(s_{i, j_{S_i}} - S_i) \cdot T &amp; &amp; m_{i, j_{S_i}} - o_i \\
    (S_i -  s_{i, j_{S_i}-1}) \cdot T &amp; &amp; m_{i, j_{S_i}} \\
    (s_{i, j_{S_i}-1} -  s_{i, j_{S_i}-2}) \cdot T &amp; &amp; m_{i, j_{S_i}-1} \\
    \vdots &amp; &amp; \vdots \\
    (s_{i, 2} -  s_{i, 1}) \cdot T &amp; &amp; m_{i, 2} \\
    (s_{i, 1} -  0) \cdot T &amp; &amp; m_{i, 1} \\
\end{bmatrix}\]</p><p>Note that the energy bid segment <span>$(s&#39;_{i,f})$</span> represents the length of the corresponding segment in the graph. This way, for our example, where <span>$j_{S_i} = 3$</span>, the pair of vectors for asset owner <span>$i$</span> is <span>$s&#39;_{i,f} = \{-2.5, 2.5, 6.25, 1.25\}$</span> and <span>$m&#39;_{i,f} = \{-0.3, -0.2, 0.05, 0.3\}$</span>.</p><h2 id="Adjust-hydro-reference-curve-for-asset-owner-i"><a class="docs-heading-anchor" href="#Adjust-hydro-reference-curve-for-asset-owner-i">Adjust hydro reference curve for asset owner <span>$i$</span></a><a id="Adjust-hydro-reference-curve-for-asset-owner-i-1"></a><a class="docs-heading-anchor-permalink" href="#Adjust-hydro-reference-curve-for-asset-owner-i" title="Permalink"></a></h2><p>The hydro reference curve for virtual reservoir <span>$r$</span> is defined as a set of points <span>$G_r = \{(Q_{r,g}, P_{r,g})\}_{g \in G}$</span>, where <span>$Q_{r,g}$</span> is the quantity and <span>$P_{r,g}$</span> is the price at point <span>$g$</span>. The image below illustrates the hydro reference curve for virtual reservoir <span>$r$</span>.</p><p><img src="assets/reference_curve.png" alt="Reference curve"/></p><p>We want to adjust the hydro reference curve for asset owner <span>$i$</span> to let it be proportional to the energy account of asset owner <span>$i$</span>: </p><p class="math-container">\[q&#39;_{r,i,g} = Q_{r,g} \cdot S_i\]</p><p>Also, we want to have a price for buying energy, so we extend the hydro reference curve to the negative side of the energy bid. This is done by adding a segment with the same price as the first point of the hydro reference curve, but with a quantity equal to the negative difference between the energy account of asset owner <span>$i$</span> and the sum of energy accounts. This negative segment represents all the available energy that asset owner <span>$i$</span> can buy from the virtual reservoir <span>$r$</span>.</p><p class="math-container">\[q&#39;_{r,i,0} = E_{r,i} - T \quad \text{and} \quad P&#39;_{r,i,0} = P_{r,1}\]</p><p>The image below shows the adjusted hydro reference curve for asset owner <span>$i$</span>.</p><p><img src="assets/adjusted_reference_curve.png" alt="Adjusted reference curve"/></p><p>The vectors that represent the adjusted hydro reference curve for asset owner <span>$i$</span> are defined as follows:</p><p class="math-container">\[\{(q&#39;_{r,i,g}, P&#39;_{r,i,g})\}_{g \in G&#39;} =  \begin{bmatrix}
    E_{r,i} - T &amp; &amp; P_{r,1} \\
    Q_{r,1} \cdot S_i &amp; &amp; P_{r,1} \\
    Q_{r,2} \cdot S_i &amp; &amp; P_{r,2} \\
    \vdots &amp; &amp; \vdots \\
    Q_{r,|G|-1} \cdot S_i &amp; &amp; P_{r,|G|-1} \\
    Q_{r,|G|} \cdot S_i &amp; &amp; P_{r,|G|} \\
\end{bmatrix}\]</p><p>where <span>$G&#39; = G \cup \{0\}$</span>.</p><h2 id="Apply-adjusted-markup-vectors-to-adjusted-hydro-reference-curve"><a class="docs-heading-anchor" href="#Apply-adjusted-markup-vectors-to-adjusted-hydro-reference-curve">Apply adjusted markup vectors to adjusted hydro reference curve</a><a id="Apply-adjusted-markup-vectors-to-adjusted-hydro-reference-curve-1"></a><a class="docs-heading-anchor-permalink" href="#Apply-adjusted-markup-vectors-to-adjusted-hydro-reference-curve" title="Permalink"></a></h2><p>Once we have the reference price and the markup for each quantity segment, we can construct the heuristic bid for asset owner <span>$i$</span>. The image below shows the adjusted hydro reference curve <span>$h&#39;(q)$</span>, the adjusted markup curve, shifted 1 unit up, <span>$1 + f&#39;(q)$</span>, and the heuristic bid <span>$p(q) = h&#39;(q)\cdot(1+f&#39;(q))$</span>. </p><p><img src="assets/final_curve.png" alt="Final curve"/></p><p>To calculate the vectors that represent the quantity bidding segments for asset owner <span>$i$</span>, we get the vectors of the adjusted hydro reference curve <span>$q&#39;_{r,i,g}$</span> and the adjusted markup energy bid segments <span>$s&#39;_{i,f}$</span>.</p><p>Based on the quantity segments <span>$q&#39;_{r,i,g}$</span>, we define the segment boundaries <span>$Q&#39;_{r,i,g}$</span>, where the price <span>$P&#39;_{r,i,g}$</span> is applied in the interval <span>$[Q&#39;_{r,i,g}, Q&#39;_{r,i,g+1})$</span>. The boundaries are defined as follows:</p><p class="math-container">\[Q&#39;^+ = \left[\sum_{g \in G&#39;, g \le h} q&#39;_{r,i,g}\right]_{h \in G&#39;, q&#39;_{r,i,h} &gt; 0} \\
Q&#39;^- = \left[\sum_{g \in G&#39;, g \ge h} q&#39;_{r,i,g}\right]_{h \in G&#39;, q&#39;_{r,i,h} &lt; 0} \\
Q&#39; = \left[ Q&#39;^-; 0; Q&#39;^+ \right]\]</p><p>We do the same for the adjusted markup segments <span>$s&#39;_{i,f}$</span>, defining the boundaries <span>$S&#39;_{i,f}$</span> as follows:</p><p class="math-container">\[S&#39;^+ = \left[\sum_{f \in F^{AO}(i), f \le h} s&#39;_{i,f}\right]_{h \in F^{AO}(i), s&#39;_{i,h} &gt; 0} \\
S&#39;^- = \left[\sum_{f \in F^{AO}(i), f \ge h} s&#39;_{i,f}\right]_{h \in F^{AO}(i), s&#39;_{i,h} &lt; 0} \\
S&#39; = \left[ S&#39;^-; 0; S&#39;^+ \right]\]</p><p>This way, the boundaries that represent the quantity bid at the heuristic bid are defined by <span>$\{Q_{r,i,k}^{VR}\}_{k \in K(r, i)} =  Q&#39; \cup S&#39;$</span>.</p><p>To find the quantity bid of each segment <span>$k$</span>, we calculate:</p><p class="math-container">\[q^{VR}_{r,i,k} = Q^{VR}_{r,i,k+1} - Q^{VR}_{r,i,k}\]</p><p>And for the price at the segment <span>$k$</span>, we calculate as follows:</p><p class="math-container">\[P^{VR}_{r,i,k} =
\max_g \left\{P&#39;_{r,i,g} \mid Q&#39;_g \le Q^{VR}_{r,i,k}\right\} \;\cdot \; \left(1+\max_{f}\left\{m&#39;_{i,f} \mid S&#39;_f \le Q^{VR}_{r,i,k} \right\}\right)\]</p><h1 id="Supply-Security-Agent"><a class="docs-heading-anchor" href="#Supply-Security-Agent">Supply Security Agent</a><a id="Supply-Security-Agent-1"></a><a class="docs-heading-anchor-permalink" href="#Supply-Security-Agent" title="Permalink"></a></h1><p>The <strong>Supply Security Agent</strong> is a special type of asset owner that acts as a safeguard for the system. If present, the following conditions must be met:</p><ul><li>It must be associated with every virtual reservoir <span>$r$</span> in the system.</li><li>It cannot be associated with any bidding group, meaning it does not own any units.</li><li>For each virtual reservoir <span>$r$</span>, the inflow share of the supply security agent must be zero, i.e., <span>$\gamma^{VR}_{r, i} = 0$</span>.</li></ul><p>The role of the supply security agent is to mitigate risks arising from the actions of other asset owners in the virtual reservoir. If the other asset owners in the virtual reservoir <span>$r$</span> are selling too much energy at a low price, this could deplete the reservoir too quickly, creating a risk of failing to meet future demand. In such cases, the supply security agent will place <strong>buying bids</strong> at a price higher than or equal to the prices of the other asset owners, effectively increasing its own energy account and reducing the rate at which water is withdrawn from the reservoir.</p><p>Conversely, if the other asset owners are selling energy at excessively high prices, the supply security agent will place <strong>selling bids</strong> at lower prices, ensuring fairer prices for consumers.</p><p>The determination of &quot;too cheap&quot; and &quot;too expensive&quot; is based on the future cost of water, ensuring the agent&#39;s actions are aligned with the long-term sustainability of the system, as presented in the hydro reference curve. </p><p>To ensure the supply security agent behaves as expected, the user can either define the markup vectors for the agent’s heuristic bid, as described above, or specify the bids in an external file.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="heuristic_bids.html">« Heuristic bids for bidding groups</a><a class="docs-footer-nextpage" href="supply_function_equilibrium.html">Supply Function Equilibrium »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 5 February 2026 21:06">Thursday 5 February 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
