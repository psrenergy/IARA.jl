<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Virtual Reservoir - Running · IARA.jl</title><meta name="title" content="Virtual Reservoir - Running · IARA.jl"/><meta property="og:title" content="Virtual Reservoir - Running · IARA.jl"/><meta property="twitter:title" content="Virtual Reservoir - Running · IARA.jl"/><meta name="description" content="Documentation for IARA.jl."/><meta property="og:description" content="Documentation for IARA.jl."/><meta property="twitter:description" content="Documentation for IARA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="IARA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">IARA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">About IARA</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="first_execution.html">My first execution</a></li><li><a class="tocitem" href="case_building.html">Editing physical data</a></li><li><a class="tocitem" href="clearing_executions.html">Editing clearing options</a></li></ul></li><li><span class="tocitem">Conceptual overview</span><ul><li><a class="tocitem" href="../key_features.html">Key features of IARA</a></li><li><a class="tocitem" href="../clearing_procedure.html">The market clearing structure</a></li><li><a class="tocitem" href="../hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../conceptual_formulation.html">Conceptual formulations</a></li><li><a class="tocitem" href="../centralized_operation_problem.html">Centralized operation problem</a></li><li><a class="tocitem" href="../market_clearing_problem.html">Market clearing problem</a></li><li><a class="tocitem" href="../heuristic_bids.html">Heuristic bids</a></li></ul></li></ul></li><li><span class="tocitem">Use guides and tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Building a case from scratch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../build_a_case_from_scratch.html">Introduction</a></li><li><a class="tocitem" href="case_01_build_base_case.html">Case creation example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manipulating bid data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../bidding_formats.html">Introduction</a></li><li><a class="tocitem" href="../heuristic_bid_examples.html">Heuristic bids examples</a></li><li><a class="tocitem" href="case_03_build_profile_base_case.html">Profile bids example</a></li><li><a class="tocitem" href="case_04_build_multi_min_activation.html">Minimum activation bids example</a></li><li><a class="tocitem" href="case_05_build_reservoir_case.html">Virtual reservoir example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Structuring the policy graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../intro_policy_graph.html">Introduction</a></li><li><a class="tocitem" href="case_06_build_policy_graph.html">Policy graphs example: building</a></li><li><a class="tocitem" href="case_06_run_policy_graph.html">Policy graphs example: running</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Custom Plots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="plots_tutorial.html">Plotting</a></li></ul></li></ul></li><li><span class="tocitem">Input and Outputs</span><ul><li><a class="tocitem" href="../quiver_format.html">Quiver</a></li><li><a class="tocitem" href="../input_files.html">Input files</a></li><li><a class="tocitem" href="../output_files.html">Output files</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="../contributing.html">Contributing</a></li><li><a class="tocitem" href="../style_guide.html">Style guide</a></li><li><a class="tocitem" href="../development_guides.html">Development guides</a></li></ul></li><li><a class="tocitem" href="../iara_platform.html">IARA Platform</a></li><li><a class="tocitem" href="../api_reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="case_05_run_reservoir_case.html">Virtual Reservoir - Running</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="case_05_run_reservoir_case.html">Virtual Reservoir - Running</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Virtual-Reservoir-Running"><a class="docs-heading-anchor" href="#Virtual-Reservoir-Running">Virtual Reservoir - Running</a><a id="Virtual-Reservoir-Running-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-Reservoir-Running" title="Permalink"></a></h1><blockquote><p>The data for this case is available in the folder <a href="https://github.com/psrenergy/IARA.jl/tree/main/docs/src/tutorial/data/case_5"><code>data/case_5</code></a></p></blockquote><pre><code class="language-julia hljs">using Dates
using DataFrames
using IARA</code></pre><h2 id="Case-recap"><a class="docs-heading-anchor" href="#Case-recap">Case recap</a><a id="Case-recap-1"></a><a class="docs-heading-anchor-permalink" href="#Case-recap" title="Permalink"></a></h2><p>In the <a href="case_05_build_reservoir_case.html">previous section</a>, we have built a case containing a virtual reservoir with two hydro units and two asset owners. Now we will run this case using the <code>MARKET_CLEARING</code> mode.</p><p>As we have Hydro Units in this case, we need the hydro generation and hydro opportunity cost time series files. We can automatically generate them by running the case with the <code>TRAIN_MIN_COST</code> mode. We will be doing this before running the case in the <code>MARKET_CLEARING</code> mode.</p><p>Let&#39;s create a folder to store the output of the <code>MARKET_CLEARING</code> mode and define the path to the original case.</p><pre><code class="language-julia hljs">const PATH_ORIGINAL = joinpath(@__DIR__, &quot;data&quot;, &quot;case_5&quot;)
const PATH_EXECUTION = joinpath(@__DIR__, &quot;case_5_execution&quot;)

if !isdir(PATH_EXECUTION)
    mkdir(PATH_EXECUTION)
end

cp(PATH_ORIGINAL, PATH_EXECUTION; force = true);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution&quot;</code></pre><h2 id="Executing"><a class="docs-heading-anchor" href="#Executing">Executing</a><a id="Executing-1"></a><a class="docs-heading-anchor-permalink" href="#Executing" title="Permalink"></a></h2><h2 id="Adding-Hydro-time-series"><a class="docs-heading-anchor" href="#Adding-Hydro-time-series">Adding Hydro time series</a><a id="Adding-Hydro-time-series-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-Hydro-time-series" title="Permalink"></a></h2><p>Now we are able to run the case with <a href="../api_reference.html#IARA.train_min_cost-Tuple{String}"><code>IARA.train_min_cost</code></a>.</p><pre><code class="language-julia hljs">IARA.train_min_cost(
    PATH_EXECUTION;
    delete_output_folder_before_execution = true,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: IARA - version: x.x.x
[ Info:
[ Info: Execution options
[ Info:    Path: /home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution
[ Info:    Output path: /home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution/outputs
[ Info:    Run mode: TRAIN_MIN_COST
[ Info:    Plot results: true
[ Info:    periods: 3
[ Info:    scenarios: 1
[ Info:    subperiods: 4
[ Info:
[ Info: Min cost Subproblems:
[ Info:    Integer variables: CALCULATE_NORMALLY
[ Info:    Network representation: NODAL
[ Info:
[ Info: Collections
[ Info:    HydroUnit: 2 element(s)
[ Info:    Zone: 1 element(s)
[ Info:    Bus: 1 element(s)
[ Info:    DemandUnit: 1 element(s)
[ Info:    AssetOwner: 2 element(s)
[ Info:    GaugingStation: 2 element(s)
[ Info:    BiddingGroup: 1 element(s)
[ Info:    VirtualReservoir: 1 element(s)
[ Info:
[ Info: Time Series from external files
[ Info:    inflow
[ Info:    demand
[ Info:
[ Info: Cuts file:
[ Info:    No cuts file
[ Info:
-------------------------------------------------------------------
         SDDP.jl (c) Oscar Dowson and contributors, 2017-24
-------------------------------------------------------------------
problem
  nodes           : 3
  state variables : 2
  scenarios       : 1.00000e+00
  existing cuts   : false
options
  solver          : serial mode
  risk measure    : SDDP.Expectation()
  sampling scheme : SDDP.InSampleMonteCarlo
subproblem structure
  VariableRef                                  : [59, 59]
  JuMP.AffExpr in MOI.EqualTo{Float64}         : [16, 16]
  JuMP.AffExpr in MOI.GreaterThan{Float64}     : [4, 4]
  JuMP.VariableRef in MOI.GreaterThan{Float64} : [45, 45]
  JuMP.VariableRef in MOI.LessThan{Float64}    : [20, 21]
  JuMP.VariableRef in MOI.Parameter{Float64}   : [12, 12]
numerical stability report
  matrix range     [1e+00, 1e+03]
  objective range  [5e-01, 1e+03]
  bounds range     [1e+02, 2e+03]
  rhs range        [8e+01, 8e+01]
-------------------------------------------------------------------
 iteration    simulation      bound        time (s)     solves  pid
-------------------------------------------------------------------
         1   2.056000e+04  2.111055e+02  1.781758e+00         6   1
        40   9.600000e+02  9.600000e+02  1.869912e+00       246   1
-------------------------------------------------------------------
status         : simulation_stopping
total time (s) : 1.869912e+00
total solves   : 246
best bound     :  9.600000e+02
simulation ci  :  1.566735e+03 ± 9.693783e+02
numeric issues : 0
-------------------------------------------------------------------

[ Info: Running post-processing routines
[ Info: Building plots</code></pre><p>After that, we have to move the cost-to-go function cuts file to the <code>case_5_execution</code> folder.</p><pre><code class="language-julia hljs">fcf_cuts_file = joinpath(
    PATH_EXECUTION,
    &quot;outputs&quot;, &quot;cuts.json&quot;,
)

fcf_cuts_destination = joinpath(PATH_EXECUTION, &quot;cuts.json&quot;)

mv(fcf_cuts_file, fcf_cuts_destination; force = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution/cuts.json&quot;</code></pre><p>Now we are ready to run the case in the <code>MARKET_CLEARING</code> mode.</p><p>As we need to set the run mode to <code>MARKET_CLEARING</code>, we need to open the study again.</p><pre><code class="language-julia hljs">db = IARA.load_study(PATH_EXECUTION; read_only = false);

IARA.update_configuration!(
    db;
    bid_data_source = IARA.Configurations_BidDataSource.READ_FROM_FILE,
    construction_type_ex_ante_physical = IARA.Configurations_ConstructionType.HYBRID,
    construction_type_ex_ante_commercial = IARA.Configurations_ConstructionType.HYBRID,
    construction_type_ex_post_physical = IARA.Configurations_ConstructionType.HYBRID,
    construction_type_ex_post_commercial = IARA.Configurations_ConstructionType.HYBRID,
)

IARA.link_time_series_to_file(
    db,
    &quot;Configuration&quot;;
    fcf_cuts = &quot;cuts.json&quot;,
)

IARA.close_study!(db)</code></pre><p>Finally, we are ready to run the case.</p><pre><code class="language-julia hljs">IARA.market_clearing(
    PATH_EXECUTION;
    delete_output_folder_before_execution = true,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: The output directory /home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution/outputs is not empty, and the argument `delete_output_folder_before_execution` has been provided. The directory&#39;s contents will be deleted.
└ @ IARA ~/work/IARA.jl/IARA.jl/src/outputs.jl:158
[ Info: IARA - version: x.x.x
[ Info:
[ Info: Execution options
[ Info:    Path: /home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution
[ Info:    Output path: /home/runner/work/IARA.jl/IARA.jl/docs/build/tutorial/case_5_execution/outputs
[ Info:    Run mode: MARKET_CLEARING
[ Info:    Plot results: true
[ Info:    periods: 3
[ Info:    scenarios: 1
[ Info:    subperiods: 4
[ Info:
[ Info: Market Clearing Subproblems:
[ Info:
[ Info:  Subproblem           Execution Mode       Integer Variables    Network Representation
[ Info:  EX_ANTE_PHYSICAL     HYBRID               CALCULATE_NORMALLY   NODAL
[ Info:  EX_ANTE_COMMERCIAL   HYBRID               CALCULATE_NORMALLY   NODAL
[ Info:  EX_POST_PHYSICAL     HYBRID               CALCULATE_NORMALLY   NODAL
[ Info:  EX_POST_COMMERCIAL   HYBRID               CALCULATE_NORMALLY   NODAL
[ Info:
[ Info: Collections
[ Info:    HydroUnit: 2 element(s)
[ Info:    Zone: 1 element(s)
[ Info:    Bus: 1 element(s)
[ Info:    DemandUnit: 1 element(s)
[ Info:    AssetOwner: 2 element(s)
[ Info:    GaugingStation: 2 element(s)
[ Info:    BiddingGroup: 1 element(s)
[ Info:    VirtualReservoir: 1 element(s)
[ Info:
[ Info: Time Series from external files
[ Info:    inflow
[ Info:    demand
[ Info:    virtual_reservoir_quantity_offer
[ Info:    virtual_reservoir_price_offer
[ Info:
[ Info: Cuts file:
[ Info:    cuts.json
[ Info:
[ Info: Running clearing for period: 1
[ Info:    Running simulation EX_ANTE_PHYSICAL
[ Info:    Running simulation EX_ANTE_COMMERCIAL
[ Info:    Running simulation EX_POST_PHYSICAL
[ Info:    Running simulation EX_POST_COMMERCIAL
[ Info: Running clearing for period: 2
[ Info:    Running simulation EX_ANTE_PHYSICAL
[ Info:    Running simulation EX_ANTE_COMMERCIAL
[ Info:    Running simulation EX_POST_PHYSICAL
[ Info:    Running simulation EX_POST_COMMERCIAL
[ Info: Running clearing for period: 3
[ Info:    Running simulation EX_ANTE_PHYSICAL
[ Info:    Running simulation EX_ANTE_COMMERCIAL
[ Info:    Running simulation EX_POST_PHYSICAL
[ Info:    Running simulation EX_POST_COMMERCIAL
[ Info: Running post-processing routines
┌ Warning: Dimension subscenario is not the last dimension. This not the most efficient way to operate over dimensions.
└ @ Quiver ~/.julia/packages/Quiver/QQM2F/src/operations.jl:109
┌ Warning: Dimension subscenario is not the last dimension. This not the most efficient way to operate over dimensions.
└ @ Quiver ~/.julia/packages/Quiver/QQM2F/src/operations.jl:109
[ Info: Building plots</code></pre><h3 id="Analyzing-the-results"><a class="docs-heading-anchor" href="#Analyzing-the-results">Analyzing the results</a><a id="Analyzing-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Analyzing-the-results" title="Permalink"></a></h3><p>The results are stored inside the case folder, in the <code>outputs</code> directory.</p><pre><code class="nohighlight hljs">case_folder
 ├── outputs
 │    ├── plots
 │    │   └── ...
 │    └── ...
 └── ...</code></pre><p>According to our results, for the first bid segment, there is more energy generated by the first Asset Owner, which is related to their bidding prices differences. The second bid segment has a similar behavior, with the the first asset owner decreasing its energy generation probably due to the decrease in the hydro volume.</p><iframe src="case_5_execution\\outputs\\plots\\virtual_reservoir_generation_ex_post_commercial_all.html" style="height:500px;width:100%;"></iframe><p>Also, the volume from the first hydro unit starts at 100 hm³, and as the energy decreases, the volume decreases as well. The second Hydro unit starts with 0 hm³ and increases over time</p><iframe src="case_5_execution\\outputs\\plots\\hydro_initial_volume_ex_post_physical_all.html" style="height:500px;width:100%;"></iframe><p>Finally, as the second hydro unit has a higher O&amp;M cost, it is only dispatched when the energy from the first hydro unit is not enough to meet the demand.</p><iframe src="case_5_execution\\outputs\\plots\\hydro_generation_ex_post_physical_all.html" style="height:500px;width:100%;"></iframe><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 18 June 2025 17:56">Wednesday 18 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
