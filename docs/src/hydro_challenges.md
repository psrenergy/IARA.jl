# Hydro reservoirs, cascades, and virtual reservoirs 

## The nature of hydropower

In the context of "zero marginal cost" electricity systems, characterized by the contributions from variable renewable energy such as wind or solar being more than sufficient to meet demand a large majority of the time, hydro resources play an interesting role. Despite being variable in longer time scales (in the sense that hydro avaialbility is uncertain), in shorter time scales hydropower is actually highly controllable and can help accommodate variable renewable energy sources.

In addition to this flexibility of allocating the hydro resource [between subperiods within a given period](key_features.md#glossary), reservoir hydro plants have even more flexibility, as they can choose to allocate their water resource over a much longer time horizon (e.g. several months). For this type of intertemporal allocation, it becomes desirable to make decisions under uncertainty taking into account the opportunity cost of future water usage as a value function, drawing from the literature of *stochastic dynamic programming* and *stochastic dual dynamic programming* (SDDP).

Another feature of hydropower that is of particular relevance for assessments of market incentives and bid-based applications is the existence of hydro cascades. In a hydro cascade, the amount of water available in the downstream power plant is dependent on decisions made in the upstream power plants, which creates a codependence between these units.

Each of these features has had an impact on the development philosophy of IARA.

## SDDP representation of intertemporal optimization

In order to properly represent hydro reservoirs' intertemporal management strategy and the corresponding opportunity costs, IARA incorporates functionality that is integrated with the **SDDP.jl** package. To this end, IARA can be run in a "train mincost" mode that will create the intertemporal structure necessary for describing optimal decisions under uncertainty, described in practice by a ["policy graph"](intro_policy_graph.md).

The "mincost" representation is not as complete as IARA's [market clearing representation](clearing_process.md), as in particular it involves simplifying the decisions each period to a single optimization problem and always using the "cost-based" representation rather than the "bid-based" one. Despite this limitation, it will produce a reasonable representation of reservoir hydro plants' "future cost function" to drive intertemporal policy, which at the very least can be useful as an initial heuristic (that can be further refined in accordance with the bidding strategies of hydro plant owners).

The outcome of the mincost representation is a set of "cuts" generated iteratively by the SDDP process and which describe intertemporal preferences for reservoir hydro plants (or, more generally, for any units that involve a state variable creating a lasting impact from one period's decisions to the next). These cuts are saved as part of the [external data structure](key_features.md#iara's-physical-system-data) of the IARA database, and will be used if needed to generate heuristic bids during the market clearing process.

## Externalities and virtual reservoirs

A classic result from economic theory is the equivalence between the solution of a central planner's optimization problem and the market equilibrium obtained from marginal pricing and profit maximization of each individual agent in the system. While this outcome is highly desirable, it relies on a number of assumptions, such as the lack of market power. The case of hydro cascades has yet another pathological issue, which is the fact that they violate the assumption of *no externalities*. Because there is no market to coordinate the joint operation of the upstream plant with the downstreap plant, price signals will be inefficient - and therefore, even as competition increases and agents' market power falls, the result of the market equilibrium will not be the same as the optimal centralized policy.

This externality issue was the main motivation for the proposal of the novel virtual reservoir mechanism as a market design strategy. Even though it would be possible to eliminate the externalities via mergers and acquisitions (i.e. forcing all hydro power plants in the same cascade to have the same owner), in the case of the Brazilian electricity system this is not practical, given the large size and complexity of Brazilian cascades, which represent a large share of the system's total capacity and already involve the coordination of multiple different owners.

Under the virtual reservoir mechanism, rather than each individual asset owner being responsible for their own hydro plants and submitting bids accordingly (despite the lack of proper price signals to take into account how their bids would affect other plants in the same cascade), bids are submitted jointly for a group of hydro plants, or "virtual reservoir". Ownership of the virtual reservoir is shared, in the sense that any agent can submit bids for any virtual reservoir: each agent has a "virtual reservoir account" that reflects the number of "shares" they currently own out of the total amount of potential energy currently stored in the physical reservoirs, and the maximum amount they can offer with their virtual reservoir bids is limited by the total amount in their account. The virtual reservoir representation in practice [changes the way how the optimization problem is constructed](conceptual_formulation.md#the-virtual-reservoir-representation).
