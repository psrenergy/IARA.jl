<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Supply Function Equilibrium · IARA.jl</title><meta name="title" content="Supply Function Equilibrium · IARA.jl"/><meta property="og:title" content="Supply Function Equilibrium · IARA.jl"/><meta property="twitter:title" content="Supply Function Equilibrium · IARA.jl"/><meta name="description" content="Documentation for IARA.jl."/><meta property="og:description" content="Documentation for IARA.jl."/><meta property="twitter:description" content="Documentation for IARA.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="IARA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">IARA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">About IARA</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="tutorial/first_execution.html">My first execution</a></li><li><a class="tocitem" href="tutorial/case_building.html">Editing physical data</a></li><li><a class="tocitem" href="tutorial/clearing_executions.html">Editing clearing options</a></li></ul></li><li><span class="tocitem">Conceptual overview</span><ul><li><a class="tocitem" href="key_features.html">Key features of IARA</a></li><li><a class="tocitem" href="clearing_procedure.html">The market clearing structure</a></li><li><a class="tocitem" href="hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="conceptual_formulation.html">Conceptual formulations</a></li><li><a class="tocitem" href="centralized_operation_problem.html">Centralized operation problem</a></li><li><a class="tocitem" href="market_clearing_problem.html">Market clearing problem</a></li><li><a class="tocitem" href="heuristic_bids.html">Heuristic bids for bidding groups</a></li><li><a class="tocitem" href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a></li><li class="is-active"><a class="tocitem" href="supply_function_equilibrium.html">Supply Function Equilibrium</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Mathematical-Formulation"><span>Mathematical Formulation</span></a></li><li><a class="tocitem" href="#Virtual-Reservoirs-vs-Bidding-Groups"><span>Virtual Reservoirs vs Bidding Groups</span></a></li><li><a class="tocitem" href="#Output-Files"><span>Output Files</span></a></li><li><a class="tocitem" href="#Usage-Example"><span>Usage Example</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a></li><li><a class="tocitem" href="bid_limits.html">Bid price limits</a></li></ul></li></ul></li><li><span class="tocitem">Use guides and tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Building a case from scratch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="build_a_case_from_scratch.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_01_build_base_case.html">Case creation example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manipulating bid data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="bidding_formats.html">Introduction</a></li><li><a class="tocitem" href="heuristic_bid_examples.html">Heuristic bids examples</a></li><li><a class="tocitem" href="tutorial/case_03_build_profile_base_case.html">Profile bids example</a></li><li><a class="tocitem" href="tutorial/case_04_build_multi_min_activation.html">Minimum activation bids example</a></li><li><a class="tocitem" href="tutorial/case_05_build_reservoir_case.html">Virtual reservoir example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Structuring the policy graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="intro_policy_graph.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_06_build_policy_graph.html">Policy graphs example: building</a></li><li><a class="tocitem" href="tutorial/case_06_run_policy_graph.html">Policy graphs example: running</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Custom Plots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="tutorial/plots_tutorial.html">Plotting</a></li></ul></li></ul></li><li><span class="tocitem">Input and Outputs</span><ul><li><a class="tocitem" href="quiver_format.html">Quiver</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Input files</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="input_files.html">Input files table</a></li><li><a class="tocitem" href="how_to_input_fcf.html">How to Input a FCF File</a></li></ul></li><li><a class="tocitem" href="output_files.html">Output files</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="style_guide.html">Style guide</a></li><li><a class="tocitem" href="development_guides.html">Development guides</a></li></ul></li><li><a class="tocitem" href="iara_platform.html">IARA Platform</a></li><li><a class="tocitem" href="api_reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Conceptual overview</a></li><li><a class="is-disabled">Formulations</a></li><li class="is-active"><a href="supply_function_equilibrium.html">Supply Function Equilibrium</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="supply_function_equilibrium.html">Supply Function Equilibrium</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Supply-Function-Equilibrium"><a class="docs-heading-anchor" href="#Supply-Function-Equilibrium">Supply Function Equilibrium</a><a id="Supply-Function-Equilibrium-1"></a><a class="docs-heading-anchor-permalink" href="#Supply-Function-Equilibrium" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>Supply Function Equilibrium (SFE) is a methodology for computing strategic bidding curves in electricity markets. In IARA.jl, SFE is enabled by setting <code>bid_processing = ITERATED_BIDS_FROM_SUPPLY_FUNCTION_EQUILIBRIUM</code>.</p><h3 id="Theoretical-Foundation"><a class="docs-heading-anchor" href="#Theoretical-Foundation">Theoretical Foundation</a><a id="Theoretical-Foundation-1"></a><a class="docs-heading-anchor-permalink" href="#Theoretical-Foundation" title="Permalink"></a></h3><p>SFE theory (Klemperer &amp; Meyer, 1989) models competition where firms submit complete supply curves (a set of sequential price-quantity pairs) rather than single price-quantity pairs. Each market participant recognizes that their bid curve influences market prices, and strategic agents adjust curves to maximize their profits. At equilibrium, no agent can improve its result by unilaterally changing its supply function.</p><h3 id="Input-Data-Sources"><a class="docs-heading-anchor" href="#Input-Data-Sources">Input Data Sources</a><a id="Input-Data-Sources-1"></a><a class="docs-heading-anchor-permalink" href="#Input-Data-Sources" title="Permalink"></a></h3><p><strong>Virtual Reservoirs:</strong> Reference curves are based on marginal water values from the hydro reference curve algorithm (see <a href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a>). These curves represent the opportunity cost of water use across different operating conditions.</p><p><strong>Bidding Groups:</strong> Reference curves come from unit generation offers for thermal, renewable, and battery assets.</p><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><h3 id="Required-Parameter"><a class="docs-heading-anchor" href="#Required-Parameter">Required Parameter</a><a id="Required-Parameter-1"></a><a class="docs-heading-anchor-permalink" href="#Required-Parameter" title="Permalink"></a></h3><pre><code class="language-julia hljs">IARA.update_configuration!(db;
    bid_processing = IARA.Configurations_BidProcessing.ITERATED_BIDS_FROM_SUPPLY_FUNCTION_EQUILIBRIUM,
)</code></pre><h3 id="SFE-Parameters"><a class="docs-heading-anchor" href="#SFE-Parameters">SFE Parameters</a><a id="SFE-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#SFE-Parameters" title="Permalink"></a></h3><ul><li><p><strong><code>supply_function_equilibrium_extra_bid_quantity</code></strong> (Float64, default: 1.0) Determines the quantity value for the artificial bid added during SFE preprocessing.</p></li><li><p><strong><code>supply_function_equilibrium_max_iterations</code></strong> (Int, default: 20) Maximum iterations for equilibrium computation within each period/scenario.</p></li><li><p><strong><code>supply_function_equilibrium_tolerance</code></strong> (Float64, default: 0.000001) Minimum slope tolerance. Curves with slopes below this value trigger errors.</p></li><li><p><strong><code>supply_function_equilibrium_max_cost_multiplier</code></strong> (Float64, default: 2.0) Maximum price cap as multiplier of deficit cost.</p></li></ul><p><strong>Example:</strong></p><pre><code class="language-julia hljs">IARA.update_configuration!(db;
    bid_processing = IARA.Configurations_BidProcessing.ITERATED_BIDS_FROM_SUPPLY_FUNCTION_EQUILIBRIUM,
    reference_curve_number_of_segments = 10,
    supply_function_equilibrium_extra_bid_quantity = 1.0,
    supply_function_equilibrium_max_iterations = 20,
    supply_function_equilibrium_tolerance = 0.000001,
    supply_function_equilibrium_max_cost_multiplier = 2.0,
    demand_deficit_cost = 3000.0,
)</code></pre><h2 id="Mathematical-Formulation"><a class="docs-heading-anchor" href="#Mathematical-Formulation">Mathematical Formulation</a><a id="Mathematical-Formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Formulation" title="Permalink"></a></h2><h3 id="Execution-Flow"><a class="docs-heading-anchor" href="#Execution-Flow">Execution Flow</a><a id="Execution-Flow-1"></a><a class="docs-heading-anchor-permalink" href="#Execution-Flow" title="Permalink"></a></h3><pre><code class="nohighlight hljs">STEP 1: Prepare Reference Curves
    - Virtual Reservoirs: Generate from marginal water values
    - Bidding Groups: Use unit generation offers
    - Allocate to asset owners and serialize

STEP 2: Apply Supply Function Equilibrium
    FOR each period and scenario:
        - Read reference curves and initial bids
        - Apply slope adjustment formula iteratively
        - Compute equilibrium bid curves
        - Write to outputs

STEP 3: Market Clearing
    - Use equilibrium bids for clearing
    - Generate spot prices and settlement</code></pre><h3 id="SFE-Algorithm"><a class="docs-heading-anchor" href="#SFE-Algorithm">SFE Algorithm</a><a id="SFE-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#SFE-Algorithm" title="Permalink"></a></h3><h4 id="Notation"><a class="docs-heading-anchor" href="#Notation">Notation</a><a id="Notation-1"></a><a class="docs-heading-anchor-permalink" href="#Notation" title="Permalink"></a></h4><p><strong>Sets:</strong></p><ul><li><span>$\mathcal{A}$</span>: Set of agents (VR-AssetOwner pairs + BG-Bus pairs)</li><li><span>$K_i$</span>: Set of segments for agent <span>$i$</span></li><li><span>$B(t)$</span>: Set of subperiods in period <span>$t$</span></li></ul><p><strong>Indices:</strong></p><ul><li><span>$i \in \mathcal{A}$</span>: Agent index</li><li><span>$k \in K_i$</span>: Segment index for agent <span>$i$</span></li><li><span>$\tau \in B(t)$</span>: Subperiod index</li></ul><p><strong>Parameters:</strong></p><ul><li><span>$C^{max}$</span>: Maximum cost multiplier</li><li><span>$C^\delta$</span>: Demand deficit cost (<span>$\$/MWh$</span>)</li><li><span>$Q_{i,\tau}$</span>: Quantity for agent <span>$i$</span> at subperiod <span>$\tau$</span></li><li><span>$P_{i,\tau}$</span>: Price for agent <span>$i$</span> at subperiod <span>$\tau$</span></li></ul><p><strong>Variables:</strong></p><ul><li><span>$q_i(k)$</span>: Cumulative quantity for agent <span>$i$</span> at segment <span>$k$</span></li><li><span>$p_i(k)$</span>: Price for agent <span>$i$</span> at segment <span>$k$</span></li><li><span>$b_i(k)$</span>: Slope <span>$\frac{dp}{dq}$</span> for agent <span>$i$</span> at segment <span>$k$</span></li><li><span>$q_i^0(k), p_i^0(k), b_i^0(k)$</span>: Original reference curve data</li><li><span>$q_i^*(k), p_i^*(k), b_i^*(k)$</span>: Equilibrium curve data</li><li><span>$p^*(k)$</span>: Market price at segment <span>$k$</span> (common to all agents)</li></ul><h4 id="Data-Preprocessing"><a class="docs-heading-anchor" href="#Data-Preprocessing">Data Preprocessing</a><a id="Data-Preprocessing-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Preprocessing" title="Permalink"></a></h4><ol><li><p><strong>Bidding Groups</strong>: Aggregate bids across subperiods before equilibrium</p><p class="math-container">\[Q_{i,agg} = \sum_{\tau \in B(t)} Q_{i,\tau}\]</p><p class="math-container">\[P_{i,agg} = \frac{\sum_{\tau \in B(t)} P_{i,\tau} \cdot Q_{i,\tau}}{Q_{i,agg}}\]</p></li><li><p><strong>All Agents</strong>: Convert segment quantities to cumulative points</p></li><li><p><strong>All Agents</strong>: Reverse to descending price order and add high-price point at deficit cost</p></li><li><p><strong>All Agents</strong>: Calculate slopes: <span>$b_i(k) = \frac{p_i(k+1) - p_i(k)}{q_i(k+1) - q_i(k)}$</span> for all <span>$i \in \mathcal{A}$</span></p></li></ol><h4 id="Iteration-Algorithm"><a class="docs-heading-anchor" href="#Iteration-Algorithm">Iteration Algorithm</a><a id="Iteration-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Iteration-Algorithm" title="Permalink"></a></h4><p><strong>Initialization</strong> (segment <span>$k=1$</span>):</p><p class="math-container">\[q_i^*(1) = q_i^0(1) \quad \forall i \in \mathcal{A}\]</p><p class="math-container">\[p^*(1) = C^{max} \cdot C^\delta\]</p><p class="math-container">\[p_i^*(1) = p^*(1) \quad \forall i \in \mathcal{A}\]</p><p class="math-container">\[b_i^*(1) = b_i^0(1) \quad \forall i \in \mathcal{A}\]</p><p><strong>Iteration</strong> for segments <span>$k = 1, 2, \ldots$</span> until all agents reach minimum quantity:</p><ol><li><p>Get available quantities: <span>$\bar{q}_i(k) = \max(q_i^*(k) - q_i^0(k^+), 0)$</span> where <span>$k^+$</span> is the next segment index for agent <span>$i$</span></p></li><li><p>Calculate price decrement: <span>$\Delta p = \min\{\bar{q}_i(k) \cdot b_i^*(k) \mid \bar{q}_i(k) &gt; 0, i \in \mathcal{A}\}$</span></p></li><li><p>Update quantities and market price:</p><p class="math-container">\[q_i^*(k+1) = q_i^*(k) - \frac{\Delta p}{b_i^*(k)} \quad \forall i \in \mathcal{A}\]</p><p class="math-container">\[p^*(k+1) = p^*(k) - \Delta p\]</p><p class="math-container">\[p_i^*(k+1) = p^*(k+1) \quad \forall i \in \mathcal{A}\]</p></li><li><p>Update slopes using equilibrium formula</p></li></ol><h3 id="Slope-Update-Formula"><a class="docs-heading-anchor" href="#Slope-Update-Formula">Slope Update Formula</a><a id="Slope-Update-Formula-1"></a><a class="docs-heading-anchor-permalink" href="#Slope-Update-Formula" title="Permalink"></a></h3><p>For segment <span>$k$</span> with all agents in <span>$\mathcal{A}$</span>:</p><p class="math-container">\[B_k = \sum_{i \in \mathcal{A}} \frac{1}{b_i^*(k)}\]</p><p class="math-container">\[b_i^*(k) = \frac{b_i^0(k)}{2} + \frac{1}{B_k} + \sqrt{\left(\frac{b_i^0(k)}{2}\right)^2 + \left(\frac{1}{B_k}\right)^2} \quad \forall i \in \mathcal{A}\]</p><p><strong>Economic Interpretation:</strong></p><p>Each agent&#39;s optimal slope <span>$b_i^*(k)$</span> balances:</p><ol><li>Cost structure: <span>$\frac{b_i^0(k)}{2}$</span> (marginal cost component)</li><li>Market responsiveness: <span>$\frac{1}{B_k}$</span> (aggregate inverse slope)</li><li>Quadratic adjustment ensuring stability</li></ol><p>In competitive markets (large <span>$|\mathcal{A}|$</span>, high <span>$B_k$</span>), slopes approach marginal costs. In concentrated markets, markups are substantial.</p><h2 id="Virtual-Reservoirs-vs-Bidding-Groups"><a class="docs-heading-anchor" href="#Virtual-Reservoirs-vs-Bidding-Groups">Virtual Reservoirs vs Bidding Groups</a><a id="Virtual-Reservoirs-vs-Bidding-Groups-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-Reservoirs-vs-Bidding-Groups" title="Permalink"></a></h2><p>The SFE algorithm treats both entity types in a unified framework with key differences:</p><p><strong>Virtual Reservoirs:</strong></p><ul><li>Period-level aggregates (no subperiod dimension)</li><li>Reference curves from marginal water values</li><li>Each VR-AssetOwner pair is an agent</li></ul><p><strong>Bidding Groups:</strong></p><ul><li>Have subperiod dimension (intra-period variation)</li><li>Reference curves from unit offers</li><li>Aggregated across subperiods before SFE</li><li>Results disaggregated back proportionally after equilibrium</li><li>Each BG-Bus pair is an agent</li></ul><p><strong>Unified Treatment:</strong> All agents processed together in same iteration loop, ensuring simultaneous equilibrium regardless of technology type.</p><h2 id="Output-Files"><a class="docs-heading-anchor" href="#Output-Files">Output Files</a><a id="Output-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Output-Files" title="Permalink"></a></h2><p>SFE generates equilibrium curves for each period/scenario:</p><p><strong>Virtual Reservoir Outputs:</strong></p><ul><li><code>virtual_reservoir_sfe_quantity.csv</code> - Equilibrium quantities (GWh)</li><li><code>virtual_reservoir_sfe_price.csv</code> - Equilibrium prices (<span>$</span>/MWh)</li><li><code>virtual_reservoir_sfe_slope.csv</code> - Equilibrium slopes (<span>$</span>/MWh²)</li></ul><p><strong>Bidding Group Outputs:</strong></p><ul><li><code>bidding_group_sfe_quantity.csv</code> - Equilibrium quantities (MWh)</li><li><code>bidding_group_sfe_price.csv</code> - Equilibrium prices (<span>$</span>/MWh)</li><li><code>bidding_group_sfe_slope.csv</code> - Equilibrium slopes (<span>$</span>/MWh²)</li></ul><p>All outputs include dimensions for agents, sfe_iteration, and sfe_curve_segment.</p><h2 id="Usage-Example"><a class="docs-heading-anchor" href="#Usage-Example">Usage Example</a><a id="Usage-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-Example" title="Permalink"></a></h2><h3 id="Setting-Up-a-Case-with-SFE"><a class="docs-heading-anchor" href="#Setting-Up-a-Case-with-SFE">Setting Up a Case with SFE</a><a id="Setting-Up-a-Case-with-SFE-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Up-a-Case-with-SFE" title="Permalink"></a></h3><pre><code class="language-julia hljs">using IARA
using Dates
using DataFrames

# Create study with SFE configuration
db = IARA.create_study!(&quot;path/to/case&quot;;
    number_of_periods = 3,
    number_of_scenarios = 2,
    number_of_subperiods = 4,
    initial_date_time = &quot;2020&quot;,
    subperiod_duration_in_hours = [250.0, 250.0, 250.0, 250.0],
    demand_deficit_cost = 500.0,
    # Enable Supply Function Equilibrium
    bid_processing = IARA.Configurations_BidProcessing.ITERATED_BIDS_FROM_SUPPLY_FUNCTION_EQUILIBRIUM,
    reference_curve_number_of_segments = 10,
)

# Add buses and zones
IARA.add_zone!(db; label = &quot;zone_1&quot;)
IARA.add_bus!(db; label = &quot;bus_1&quot;, zone_id = &quot;zone_1&quot;)

# Add hydro units
IARA.add_hydro_unit!(db;
    label = &quot;hydro_1&quot;,
    initial_volume = 900.0,
    bus_id = &quot;bus_1&quot;,
    parameters = DataFrame(;
        date_time = [DateTime(0)],
        existing = Int(IARA.HydroUnit_Existence.EXISTS),
        production_factor = 3.6,
        max_generation = 400.0,
        max_turbining = 0.4,
        min_volume = 0.0,
        max_volume = 2000.0,
        om_cost = 10.0,
    ),
)

IARA.add_hydro_unit!(db;
    label = &quot;hydro_2&quot;,
    initial_volume = 0.0,
    bus_id = &quot;bus_1&quot;,
    parameters = DataFrame(;
        date_time = [DateTime(0)],
        existing = Int(IARA.HydroUnit_Existence.EXISTS),
        production_factor = 3.6,
        max_generation = 700.0,
        max_turbining = 0.7,
        min_volume = 0.0,
        max_volume = 0.0,
        om_cost = 10.0,
    ),
)

IARA.set_hydro_turbine_to!(db, &quot;hydro_1&quot;, &quot;hydro_2&quot;)

# Add asset owners (for SFE competition)
IARA.add_asset_owner!(db;
    label = &quot;utility_A&quot;,
    price_type = IARA.AssetOwner_PriceType.PRICE_MAKER,
)

IARA.add_asset_owner!(db;
    label = &quot;utility_B&quot;,
    price_type = IARA.AssetOwner_PriceType.PRICE_MAKER,
)

IARA.add_asset_owner!(db;
    label = &quot;utility_C&quot;,
    price_type = IARA.AssetOwner_PriceType.PRICE_MAKER,
)

# Create virtual reservoir with multiple owners
IARA.add_virtual_reservoir!(db;
    label = &quot;reservoir_1&quot;,
    assetowner_id = [&quot;utility_A&quot;, &quot;utility_B&quot;, &quot;utility_C&quot;],
    inflow_allocation = [0.4, 0.3, 0.3],
    initial_energy_account_share = [0.4, 0.3, 0.3],
    hydrounit_id = [&quot;hydro_1&quot;, &quot;hydro_2&quot;],
)

IARA.close_study!(db)

# Run training and market clearing
IARA.train_min_cost(&quot;path/to/case&quot;)
IARA.market_clearing(&quot;path/to/case&quot;)</code></pre><h3 id="Modifying-an-Existing-Case"><a class="docs-heading-anchor" href="#Modifying-an-Existing-Case">Modifying an Existing Case</a><a id="Modifying-an-Existing-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-an-Existing-Case" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Load existing case
db = IARA.load_study(&quot;path/to/case&quot;; read_only = false)

# Enable SFE
IARA.update_configuration!(db;
    bid_processing = IARA.Configurations_BidProcessing.ITERATED_BIDS_FROM_SUPPLY_FUNCTION_EQUILIBRIUM,
    reference_curve_number_of_segments = 10,
)

# Add more asset owners to existing virtual reservoir
IARA.add_asset_owner!(db;
    label = &quot;utility_D&quot;,
    price_type = IARA.AssetOwner_PriceType.PRICE_MAKER,
)

# Update virtual reservoir to include new owner
IARA.delete_element!(db, &quot;VirtualReservoir&quot;, &quot;reservoir_1&quot;)
IARA.add_virtual_reservoir!(db;
    label = &quot;reservoir_1&quot;,
    assetowner_id = [&quot;utility_A&quot;, &quot;utility_B&quot;, &quot;utility_C&quot;, &quot;utility_D&quot;],
    inflow_allocation = [0.3, 0.3, 0.2, 0.2],
    initial_energy_account_share = [0.3, 0.3, 0.2, 0.2],
    hydrounit_id = [&quot;hydro_1&quot;, &quot;hydro_2&quot;],
)

IARA.close_study!(db)

# Run market clearing with SFE
IARA.market_clearing(&quot;path/to/case&quot;)</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Klemperer, P., &amp; Meyer, M. (1989). &quot;Supply Function Equilibria in Oligopoly under Uncertainty.&quot; <em>Econometrica</em>, 57(6), 1243-1277.</li><li>Green, R. J., &amp; Newbery, D. M. (1992). &quot;Competition in the British Electricity Spot Market.&quot; <em>Journal of Political Economy</em>, 100(5), 929-953.</li><li>Holmberg, P. (2008). &quot;Unique Supply Function Equilibrium with Capacity Constraints.&quot; <em>Energy Economics</em>, 30(1), 148-172.</li><li>Resende, M. M. <em>Equilíbrio de Nash em Mercados de Energia Elétrica com Formação de Preços por Ofertas</em>. Master&#39;s Dissertation. (Portuguese)</li><li>Peixoto, B. <em>Arcabouço Iterativo para Resolução do Equilíbrio de Funções de Oferta em Mercados de Energia Elétrica</em>. Master&#39;s Dissertation. (Portuguese)</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="heuristic_bids_vr.html">« Heuristic bids for virtual reservoirs</a><a class="docs-footer-nextpage" href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 27 January 2026 20:13">Tuesday 27 January 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
