<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The market clearing structure · IARA.jl</title><meta name="title" content="The market clearing structure · IARA.jl"/><meta property="og:title" content="The market clearing structure · IARA.jl"/><meta property="twitter:title" content="The market clearing structure · IARA.jl"/><meta name="description" content="Documentation for IARA.jl."/><meta property="og:description" content="Documentation for IARA.jl."/><meta property="twitter:description" content="Documentation for IARA.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="IARA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">IARA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">About IARA</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="tutorial/first_execution.html">My first execution</a></li><li><a class="tocitem" href="tutorial/case_building.html">Editing physical data</a></li><li><a class="tocitem" href="tutorial/clearing_executions.html">Editing clearing options</a></li></ul></li><li><span class="tocitem">Conceptual overview</span><ul><li><a class="tocitem" href="key_features.html">Key features of IARA</a></li><li class="is-active"><a class="tocitem" href="clearing_procedure.html">The market clearing structure</a><ul class="internal"><li><a class="tocitem" href="#Clearing-Procedures"><span>Clearing Procedures</span></a></li><li><a class="tocitem" href="#Model-Clearing-model-types"><span>Model Clearing model types</span></a></li><li><a class="tocitem" href="#Standard-Reservoir-settlement"><span>Standard Reservoir settlement</span></a></li></ul></li><li><a class="tocitem" href="hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="conceptual_formulation.html">Conceptual formulations</a></li><li><a class="tocitem" href="centralized_operation_problem.html">Centralized operation problem</a></li><li><a class="tocitem" href="market_clearing_problem.html">Market clearing problem</a></li><li><a class="tocitem" href="heuristic_bids.html">Heuristic bids for bidding groups</a></li><li><a class="tocitem" href="heuristic_bids_vr.html">Heuristic bids for virtual reservoirs</a></li><li><a class="tocitem" href="supply_function_equilibrium.html">Supply Function Equilibrium</a></li><li><a class="tocitem" href="post_processing_virtual_reservoir.html">Virtual reservoirs pre and post processing</a></li><li><a class="tocitem" href="bid_limits.html">Bid price limits</a></li></ul></li></ul></li><li><span class="tocitem">Use guides and tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Building a case from scratch</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="build_a_case_from_scratch.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_01_build_base_case.html">Case creation example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manipulating bid data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="bidding_formats.html">Introduction</a></li><li><a class="tocitem" href="heuristic_bid_examples.html">Heuristic bids examples</a></li><li><a class="tocitem" href="tutorial/case_03_build_profile_base_case.html">Profile bids example</a></li><li><a class="tocitem" href="tutorial/case_04_build_multi_min_activation.html">Minimum activation bids example</a></li><li><a class="tocitem" href="tutorial/case_05_build_reservoir_case.html">Virtual reservoir example</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Structuring the policy graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="intro_policy_graph.html">Introduction</a></li><li><a class="tocitem" href="tutorial/case_06_build_policy_graph.html">Policy graphs example: building</a></li><li><a class="tocitem" href="tutorial/case_06_run_policy_graph.html">Policy graphs example: running</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Custom Plots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="tutorial/plots_tutorial.html">Plotting</a></li></ul></li></ul></li><li><span class="tocitem">Input and Outputs</span><ul><li><a class="tocitem" href="quiver_format.html">Quiver</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Input files</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="input_files.html">Input files table</a></li><li><a class="tocitem" href="how_to_input_fcf.html">How to Input a FCF File</a></li></ul></li><li><a class="tocitem" href="output_files.html">Output files</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="contributing.html">Contributing</a></li><li><a class="tocitem" href="style_guide.html">Style guide</a></li><li><a class="tocitem" href="development_guides.html">Development guides</a></li></ul></li><li><a class="tocitem" href="iara_platform.html">IARA Platform</a></li><li><a class="tocitem" href="api_reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Conceptual overview</a></li><li class="is-active"><a href="clearing_procedure.html">The market clearing structure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="clearing_procedure.html">The market clearing structure</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Clearing-Formulation"><a class="docs-heading-anchor" href="#Clearing-Formulation">Clearing Formulation</a><a id="Clearing-Formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Clearing-Formulation" title="Permalink"></a></h1><p>One of the <a href="key_features.html">key features</a> of IARA is the organization of the Market Clearing process into four subproblems: Ex-Ante Physical, Ex-Ante Commercial, Ex-post Physical, and Ex-post Commercial.</p><p>The typical structure according to which these four subproblems are structured is illustrated in the image below. Note that each iteration of the market clearing process involves solving all four subproblems (one instance of each of the ex ante subproblems and several instances of each of the ex post subproblems, one for each subscenario). The ending state of the previous period&#39;s optimization problem (<span>$T-1$</span>) is an input for all four subproblems, and the present period (<span>$T$</span>)&#39;s ending state is also passed on to the next iteration of the market clearing process. Note that it is the final state of one of the instances of the ex post physical optimization problem that will typically be the driver of this ending state.</p><p>Other arrows in the diagram below represent other input data (physical random variables and submitted bids) that are collected as part of <a href="key_features.html#the-market-clearing-process">IARA&#39;s main market clearing process</a>, as well as output variables (assigned quantities and marginal costs). Converting the assigned quantities and marginal costs into a price signal is part of IARA&#39;s post-processing feature.</p><p><img src="assets/Picture_Subproblems.png" alt="Diagram"/></p><p>Even though the above diagram is the &quot;default&quot; structure for the market clearing process, which is quite flexible and able to accommodate a number of market designs, some market design choices might either omit some of these steps or introduce relationships between the subproblems. You can <a href="tutorial/first_execution.html">get started</a> by exploring IARA&#39;s features for representing market design options that will affect the clearing process.</p><h2 id="Clearing-Procedures"><a class="docs-heading-anchor" href="#Clearing-Procedures">Clearing Procedures</a><a id="Clearing-Procedures-1"></a><a class="docs-heading-anchor-permalink" href="#Clearing-Procedures" title="Permalink"></a></h2><h3 id="Ex-Ante"><a class="docs-heading-anchor" href="#Ex-Ante">Ex-Ante</a><a id="Ex-Ante-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Ante" title="Permalink"></a></h3><p>The Ex-Ante step is responsible for calculating the physical and commercial dispatches one day before the actual operation. The Ex-Ante step is divided into two steps: Ex-Ante Physical and Ex-Ante Commercial.  In the Virtual Reservoir, the allocation of predicted inflows for this agent is added to its balance.</p><h3 id="Ex-Ante-Physical"><a class="docs-heading-anchor" href="#Ex-Ante-Physical">Ex-Ante Physical</a><a id="Ex-Ante-Physical-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Ante-Physical" title="Permalink"></a></h3><p>The Ex-Ante Physical step is responsible for calculating the physical generation amount that will be dispatched a day before the actual operation. The physical units are calculated based on the bids submitted by the agents and the constraints of the system. In the Virtual Reservoir, the allocation of predicted inflows for this agent is added to its balance. In this problem, the Market Clearing is calculated with all integer variables, and the result will generally be used in other subsequent problems.</p><h3 id="Ex-Ante-Commercial"><a class="docs-heading-anchor" href="#Ex-Ante-Commercial">Ex-Ante Commercial</a><a id="Ex-Ante-Commercial-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Ante-Commercial" title="Permalink"></a></h3><p>The Ex-Ante Commercial step is responsible for determining the clearing prices of the day-ahead market.</p><p>There are three approaches to calculate these prices:</p><ol><li><p><strong>Post-MIP Solution Approach</strong>: After solving the Mixed-Integer Program (MIP), the binary variables are fixed according to the solution, and the resulting Linear Program (LP) is solved. The dual solution of this LP provides the clearing prices.</p></li><li><p><strong>LP with Fixed Binary Variables</strong>: This approach involves solving the LP that is derived by fixing the binary variables to specific values. Currently, the values of the binary variables are taken from the solution of the ex-ante physical problem.</p></li><li><p><strong>Relaxation of Integrality Constraints</strong>: In this method, the integrality constraints of the MIP are relaxed, and the resulting LP is solved to determine the clearing prices.</p></li></ol><h3 id="Ex-Post"><a class="docs-heading-anchor" href="#Ex-Post">Ex-Post</a><a id="Ex-Post-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Post" title="Permalink"></a></h3><p>In ex-post problems, a set of sub-scenarios can be provided for each scenario verified in the ex-ante, representing shocks that simulate real-time variations. Each scenario can have their own set of sub-scenarios, but the number of sub-scenarios must be the same for all scenarios.</p><p>The first sub-scenario calculated in the ex-post is used to transmit the state variable information and the virtual reservoir balance to the next period.</p><p>At a given period, the Virtual Reservoir balance is added to the ex-post inflow allocation for this agent in its balance, and the bids accepted by the Operator are debited. After this operation, an adjustment can be made so that the Virtual Reservoir balance equals the Available Energy of the hydros that make up this reservoir.</p><h3 id="Ex-Post-Physical"><a class="docs-heading-anchor" href="#Ex-Post-Physical">Ex-Post Physical</a><a id="Ex-Post-Physical-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Post-Physical" title="Permalink"></a></h3><p>The Ex-Post Physical step is responsible for calculating the physical generation amount that will be dispatched in real-time. The physical units are determined based on the bids submitted by the agents and the system&#39;s constraints. In the Virtual Reservoir, the allocation of inflows for the agent is added to its balance.</p><p>The binary variable can be handled in the following ways:</p><ol><li><p><strong>Post-MIP Solution Approach</strong>: The Mixed-Integer Program (MIP) fixes the binary variables, and then the program is run with these variables fixed.</p></li><li><p><strong>LP with Fixed Binary Variables</strong>: The Linear Program (LP) uses binary variables that are fixed based on the solution from a prior problem, such as the ex-ante physical or commercial problem.</p></li><li><p><strong>Relaxation of Integrality Constraints</strong>: The LP is run with relaxed integrality constraints, allowing for continuous variables instead of discrete binary variables.</p></li></ol><h3 id="Ex-Post-Commercial"><a class="docs-heading-anchor" href="#Ex-Post-Commercial">Ex-Post Commercial</a><a id="Ex-Post-Commercial-1"></a><a class="docs-heading-anchor-permalink" href="#Ex-Post-Commercial" title="Permalink"></a></h3><p>Ex-Post Commercial</p><p>The Ex-Post Commercial step is responsible for calculating the clearing prices of the real-time market.</p><p>There are three approaches to calculate these prices:</p><ol><li><p><strong>Post-MIP Solution Approach</strong>: The Mixed-Integer Program (MIP) fixes the variables, and then the program is run with these variables fixed.</p></li><li><p><strong>LP with Fixed Binary Variables</strong>: The Linear Program (LP) receives binary variables that are fixed based on the solution of a prior problem. These variables can come from either the ex-ante or ex-post physical problems.</p></li><li><p><strong>Relaxation of Integrality Constraints</strong>: The LP is run with relaxed integrality constraints, allowing for continuous variables instead of binary ones.</p></li></ol><p>In all procedures, it&#39;s possible to add the FCF from the MinCost module and a wave-guide curve as a tie-break for the Virtual Reservoir bids.</p><h2 id="Model-Clearing-model-types"><a class="docs-heading-anchor" href="#Model-Clearing-model-types">Model Clearing model types</a><a id="Model-Clearing-model-types-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Clearing-model-types" title="Permalink"></a></h2><p>The Market Clearing can be calculated in three ways:</p><ol><li>Cost Based Dispatch: The dispatch is calculated based only on the physical attributes of the system. The objective is to minimize the total cost of the system. No bids are considered in this case.</li><li>Bid Based Dispatch: The dispatch is calculated based only on the bids submitted by the agents. The objective is to minimize the total cost of the bids accepted by the Operator. The physical constraints are not considered in this case.</li><li>Hybrid Dispatch: The dispatch is calculated based on the bids submitted by the agents and the physical constraints of the system serve as a limit for the accepted bids and a tie-break for the bids with the same cost. The objective is to minimize the total cost of the bids accepted by the Operator.</li></ol><p>Any step of the Market Clearing can be calculated with any of the three model types described above.</p><h2 id="Standard-Reservoir-settlement"><a class="docs-heading-anchor" href="#Standard-Reservoir-settlement">Standard Reservoir settlement</a><a id="Standard-Reservoir-settlement-1"></a><a class="docs-heading-anchor-permalink" href="#Standard-Reservoir-settlement" title="Permalink"></a></h2><p>This is a post processing feature related to the revenue of the agents that isn&#39;t related to Virtual Reservoirs. Notation:</p><ul><li><p class="math-container">\[\omega \in \{\text{ex-ante}, \text{ex-post}\}\]</p>: subproblem types.</li><li><p class="math-container">\[q^{\omega}\]</p>: primal variable representing the quantity of energy dispatched in the ex-ante or ex-post physical subproblem.</li><li><p class="math-container">\[\pi^{\omega}\]</p>: dual variable representing the marginal costs in the ex-ante or ex-post commercial subproblem.</li></ul><p>The revenue of the agents is calculated as follows:</p><table><tr><th style="text-align: right">Settlement Type</th><th style="text-align: right">Expression</th></tr><tr><td style="text-align: right">EX_POST</td><td style="text-align: right"><span>$q^{\text{ex-post}} \pi^{\text{ex-post}}$</span></td></tr><tr><td style="text-align: right">EX_ANTE</td><td style="text-align: right"><span>$q^{\text{ex-post}} \pi^{\text{ex-ante}}$</span></td></tr><tr><td style="text-align: right">TWO_SETTLEMENT</td><td style="text-align: right"><span>$q^{\text{ex-ante}} \pi^{\text{ex-ante}}+(q^{\text{ex-post}}-q^{\text{ex-ante}} ) \pi^{\text{ex-post}}$</span></td></tr></table><ul><li>The default file for <strong>generation</strong> is the <em>Physical</em> Problem. If this file is unavailable due to being skipped, the model will use the <em>Commercial</em> Problem instead, but a warning will be generated to indicate a non-standard execution type.</li><li>The default file for <strong>marginal costs</strong> is the <em>Commercial Problem</em>. If this file is unavailable due to being skipped, the model will use the <em>Physical Problem</em> instead.</li><li>In <strong>EX_ANTE</strong> or <strong>TWO_SETTLEMENT</strong> settlements, if both the <em>Ex Ante Physical</em> and <em>Ex Ante Commercial</em> Problems or both <em>Ex Post Physical</em> and <em>Ex Post Commercial</em> Problems are skipped, an error will occur.</li><li>In <strong>EX_POST</strong> settlements, if both the <em>Ex Post Physical</em> and <em>Ex Post Commercial</em> Problems are skipped, an error will occur.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="key_features.html">« Key features of IARA</a><a class="docs-footer-nextpage" href="hydro_challenges.html">Hydro reservoirs, cascades and virtual reservoirs »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 5 February 2026 20:27">Thursday 5 February 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
